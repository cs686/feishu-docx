# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.2.0] - 2026-02-01

### 🚀 Major Refactoring

#### SDK 架构重构
- **组合模式重构** - SDK 从单体类拆分为 7 个职责清晰的子模块：
  - `sdk.docx` - 云文档操作
  - `sdk.sheet` - 电子表格操作
  - `sdk.bitable` - 多维表格操作
  - `sdk.wiki` - 知识库操作
  - `sdk.media` - 媒体资源操作
  - `sdk.contact` - 联系人操作
  - `sdk.apaas` - APaaS 数据库操作
- **懒加载机制** - 子模块按需初始化，提升启动性能
- **完全向后兼容** - 旧 API 保持可用

#### CLI 模块拆分
- **模块化重构** - 1110 行 `main.py` 拆分为 7 个独立模块：
  - `main.py` - 入口，命令注册
  - `common.py` - 共享工具函数
  - `cmd_export.py` - 导出命令
  - `cmd_write.py` - 写入命令
  - `cmd_apaas.py` - APaaS 命令
  - `cmd_auth.py` - 认证命令
  - `cmd_config.py` - 配置命令
  - `cmd_tui.py` - TUI 命令

### Added
- **知识空间批量导出 API** - `FeishuExporter.export_wiki_space()` 方法，支持 Python API 调用
- `WikiAPI.get_space_info()` - 获取知识空间名称
- 导出目录自动使用 space_name 命名子目录
- 所有 CLI 命令新增 `--auth-mode` 参数，支持命令行指定认证模式
- 新增环境变量 `FEISHU_AUTH_MODE` 支持
- `get_credentials()` 三参数独立优先级：命令行 > 环境变量 > 配置文件

### Changed
- 认证逻辑统一化，`app_id`、`app_secret`、`auth_mode` 遵循相同优先级规则
- Parser 使用组合模式 SDK，代码更简洁
- Wiki SDK 方法失败时抛出异常而不是返回 None

---

## [0.1.5] - 2026-01-29

### Changed
- 改进获取文档块列表的逻辑以支持分页获取所有blocks
- 使用官方的Block模型
- 新增 larkoffice.com 域名文件解析(部分文档图片无权限下载)
- 支持 Markdown 本地转换与图片回填，创建时可上传完整文档

## [0.1.4] - 2026-01-16

### Added
- 文件/附件 Block 支持，生成带临时下载链接的 markdown（📎 格式）

---

## [0.1.3] - 2026-01-12

### Added
- CLI `--stdout` / `-c` 参数，直接输出内容到标准输出（适合 AI Agent）
- TUI Access Token 输入框支持
- TUI URL 输入历史（上下箭头浏览）
- TUI 动态进度回调，实时显示解析进度
- TUI 详细错误日志（显示 traceback 最后 3 行）
- OAuth 授权页面简约重新设计（深色主题）
- GitHub Actions 自动发布到 PyPI

### Changed
- README 图片链接改为 GitHub raw 链接（PyPI 可显示）
- OAuth 页面模板抽取到 `auth/templates.py`

### Fixed
- README 中英文切换链接修复

---

## [0.1.0] - 2026-01-10

### Added
- 初始版本发布
- 云文档 (docx) 导出为 Markdown
- 电子表格 (sheet) 导出为 Markdown 表格
- 多维表格 (bitable) 导出为 Markdown 表格
- 知识库 (wiki) 节点自动解析导出
- 图片自动下载并本地引用
- 画板导出为图片
- OAuth 2.0 授权 + Token 自动刷新
- CLI 命令行工具
- TUI 终端界面（基于 Textual）
- Claude Skills 支持
